{% extends "base.html" %}
{% block title %}Top Tracks{% endblock %}

{% block content %}
<div class="page">
  <div class="page-container mb-8">
    <div class="page-eyebrow">Spotify Stats</div>
    <h1 class="page-title">Your Top Tracks</h1>
  </div>

  <div class="page-container filter-form border-b border-neutral-200 pb-6 flex flex-wrap items-end gap-4">
    <form method="get" action="/top-tracks" class="flex gap-4 flex-wrap items-end">
      <div>
        <label class="filter-label">Time Range</label>
        <select name="time_range" onchange="this.form.submit()" class="filter-select">
          <option value="short_term" {% if time_range == "short_term" %}selected{% endif %}>Last 4 weeks</option>
          <option value="medium_term" {% if time_range == "medium_term" %}selected{% endif %}>Last 6 months</option>
          <option value="long_term" {% if time_range == "long_term" %}selected{% endif %}>All time</option>
        </select>
      </div>
      <div>
        <label class="filter-label">Show</label>
        <select name="limit" onchange="this.form.submit()" class="filter-select">
          <option value="10" {% if limit == 10 %}selected{% endif %}>10</option>
          <option value="25" {% if limit == 25 %}selected{% endif %}>25</option>
          <option value="50" {% if limit == 50 %}selected{% endif %}>50</option>
        </select>
      </div>
    </form>
    <form method="post" action="/generate-playlist" class="ml-auto flex items-end">
      {% for track in tracks %}
        <input type="hidden" name="track_uri" value="{{ track.uri }}">
      {% endfor %}

      <button type="submit" class="filter-select font-medium text-neutral-800 hover:text-[#1DB954] transition-colors duration-300">
        Generate Playlist →
      </button>
    </form>
  </div>

  <div class="page-container list">
    {% for track in tracks %}
    <a href="{{ track.external_urls.spotify }}" target="_blank" rel="noopener noreferrer" class="block">
      <div class="list-row">

        <div class="list-rank">{{ loop.index }}</div>

        <div class="list-image">
          {% if track.album.images %}
            <div class="w-14 h-14 rounded overflow-hidden bg-neutral-200">
              <img src="{{ track.album.images[0].url }}" alt="{{ track.name }}" class="w-full h-full object-cover scale-110" />
            </div>
          {% else %}
            <div class="w-14 h-14 rounded bg-neutral-300"></div>
          {% endif %}
        </div>

        <div class="flex-grow">
          <div class="list-title">{{ track.name }}</div>
          <div class="list-subtitle">{{ track.artists | map(attribute='name') | join(', ') }} · {{ track.album.release_date[:4] }}</div>
        </div>

        <div class="list-hint tabular-nums">
          {{ (track.duration_ms // 60000) }}:{{ '%02d' % ((track.duration_ms // 1000) % 60) }}
        </div>
      </div>
    </a>
    {% endfor %}
  </div>

</div>
{% endblock %}
